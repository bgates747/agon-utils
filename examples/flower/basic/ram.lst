PC     Output      Line
040000             0001  ;
040000             0002  ; Title:	BBC Basic Interpreter - Z80 version
040000             0003  ;		RAM Module for BBC Basic Interpreter
040000             0004  ;		For use with Version 2.0 of BBC BASIC
040000             0005  ;		Standard CP/M Distribution Version
040000             0006  ; Author:	(C) Copyright  R.T.Russell 31-12-1983
040000             0007  ; Modified By:	Dean Belfield
040000             0008  ; Created:	12/05/2023
040000             0009  ; Last Updated:	26/06/2023
040000             0010  ;
040000             0011  ; Modinfo:
040000             0012  ; 06/06/2023:	Modified to run in ADL mode
040000             0013  ; 26/06/2023:	Added temporary stores R0 and R1
040000             0014  
040000             0015  			.ASSUME	ADL = 1
040000             0016  
040000             0017  			; DEFINE	LORAM, SPACE = ROM
040000             0018  			; SEGMENT LORAM
040000             0019  
040000             0020  			; XDEF	ACCS
040000             0021  			; XDEF	BUFFER
040000             0022  			; XDEF	STAVAR
040000             0023  			; XDEF	DYNVAR
040000             0024  			; XDEF	FNPTR
040000             0025  			; XDEF	PROPTR
040000             0026  			; XDEF	PAGE_
040000             0027  			; XDEF	TOP
040000             0028  			; XDEF	LOMEM
040000             0029  			; XDEF 	FREE
040000             0030  			; XDEF	HIMEM
040000             0031  			; XDEF	LINENO
040000             0032  			; XDEF	TRACEN
040000             0033  			; XDEF	AUTONO
040000             0034  			; XDEF	ERRTRP
040000             0035  			; XDEF	ERRTXT
040000             0036  			; XDEF	DATPTR
040000             0037  			; XDEF	ERL
040000             0038  			; XDEF	ERRLIN
040000             0039  			; XDEF	RANDOM
040000             0040  			; XDEF	COUNT
040000             0041  			; XDEF	WIDTH
040000             0042  			; XDEF	ERR
040000             0043  			; XDEF	LISTON
040000             0044  			; XDEF	INCREM
040000             0045  
040000             0046  			; XDEF	FLAGS
040000             0047  			; XDEF	OSWRCHPT
040000             0048  			; XDEF	OSWRCHCH
040000             0049  			; XDEF	OSWRCHFH
040000             0050  			; XDEF	KEYDOWN
040000             0051  			; XDEF	KEYASCII
040000             0052  			; XDEF	KEYCOUNT
040000             0053  
040000             0054  			; XDEF	R0
040000             0055  			; XDEF	R1
040000             0056  
040000             0057  			; XDEF	RAM_START
040000             0058  			; XDEF	RAM_END
040000             0059  			; XDEF	USER
040000             0060  
040000             0061  			ALIGN 		256		; ACCS, BUFFER & STAVAR must be on page boundaries
040000             0062  RAM_START:
040000             0063  ;
040000             0064  ACCS:			DS		256             ; String Accumulator
040100             0065  BUFFER:			DS		256             ; String Input Buffer
040200             0066  STAVAR:			DS	 	27*4            ; Static Variables
04026C             0067  DYNVAR: 		DS 		54*3            ; Dynamic Variable Pointers
04030E             0068  FNPTR:  		DS    		3               ; Dynamic Function Pointers
040311             0069  PROPTR: 		DS		3               ; Dynamic Procedure Pointers
040314             0070  ;
040314             0071  PAGE_:   		DS		3               ; Start of User Program
040317             0072  TOP:    		DS		3               ; First Location after User Program
04031A             0073  LOMEM:  		DS		3               ; Start of Dynamic Storage
04031D             0074  FREE:   		DS		3               ; First Free Space Byte
040320             0075  HIMEM:  		DS		3               ; First Protected Byte
040323             0076  ;
040323             0077  LINENO: 		DS		3               ; Line Number
040326             0078  TRACEN:			DS		3               ; Trace Flag
040329             0079  AUTONO:			DS		3               ; Auto Flag
04032C             0080  ERRTRP:			DS		3               ; Error Trap
04032F             0081  ERRTXT:			DS		2               ; Error Message Pointer
040331             0082  DATPTR:			DS		2               ; Data Pointer
040333             0083  ERL:			DS		2               ; Error Line
040335             0084  ERRLIN:			DS		3               ; The "ON ERROR" Line
040338             0085  RANDOM:			DS		5               ; Random Number
04033D             0086  COUNT:			DS		1               ; Print Position
04033E             0087  WIDTH:			DS		1               ; Print Width
04033F             0088  ERR:			DS		1               ; Error Number
040340             0089  LISTON:			DS		1               ; LISTO (bottom nibble)
040341             0090  							; - BIT 0: If set, output a space after the line number
040341             0091  							; - BIT 1: If set, then indent FOR/NEXT loops
040341             0092  							; - BIT 2: If set, then indent REPEAT/UNTIL loops
040341             0093  							; - BIT 3: If set, then output to buffer for *EDIT
040341             0094  							; OPT FLAG (top nibble)
040341             0095  							; - BIT 4: If set, then list whilst assembling
040341             0096  							; - BIT 5: If set, then assembler errors are reported
040341             0097  							; - BIT 6: If set, then place the code starting at address pointed to by O%
040341             0098  							; - BIT 7: If set, then assemble in ADL mode, otherwise assemble in Z80 mode
040341             0099  INCREM:			DS		1               ; Auto-Increment Value
040342             0100  ;
040342             0101  ; Extra Agon-implementation specific system variables
040342             0102  ;
040342             0103  FLAGS:			DS		1		; Miscellaneous flags
040343             0104  							; - BIT 7: Set if ESC pressed
040343             0105  							; - BIT 6: Set to disable ESC
040343             0106  OSWRCHPT:		DS		2		; Pointer for *EDIT
040345             0107  OSWRCHCH:		DS		1		; Channel of OSWRCH
040346             0108  							; - 0: Console
040346             0109  							; - 1: File
040346             0110  OSWRCHFH:		DS		1		; File handle for OSWRCHCHN
040347             0111  KEYDOWN:		DS		1		; Keydown flag
040348             0112  KEYASCII:		DS		1		; ASCII code of pressed key
040349             0113  KEYCOUNT:		DS		1		; Counts every time a key is pressed
04034A             0114  R0:			DS		3		; General purpose storage for 8/16 to 24 bit operations
04034D             0115  R1:			DS		3		;
040350             0116  ;
040350             0117  ; This must be at the end
040350             0118  ;
040350             0119  RAM_END:
040350 FF FF FF FF 0120  			ALIGN	256
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
040400             0121  USER:							; Must be aligned on a page boundary
040400             0122  
