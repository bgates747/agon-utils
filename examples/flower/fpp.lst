PC     Output      Line
040000             0001  ;
040000             0002  ; Title:	BBC Basic Interpreter - Z80 version
040000             0003  ;		Z80 Floating Point Package
040000             0004  ; Author:	(C) Copyright  R.T.Russell  1986
040000             0005  ; Modified By:	Dean Belfield
040000             0006  ; Created:	03/05/2022
040000             0007  ; Last Updated:	07/06/2023
040000             0008  ;
040000             0009  ; Modinfo:
040000             0010  ; 26/10/1986:	Version 0.0
040000             0011  ; 14/12/1988:	Vesion 0.1 (Bug Fix)
040000             0012  ; 12/05/2023:	Modified by Dean Belfield
040000             0013  ; 07/06/2023:	Modified to run in ADL mode
040000             0014  ;
040000             0015  ;BINARY FLOATING POINT REPRESENTATION:
040000             0016  ;   32 BIT SIGN-MAGNITUDE NORMALIZED MANTISSA
040000             0017  ;    8 BIT EXCESS-128 SIGNED EXPONENT
040000             0018  ;   SIGN BIT REPLACES MANTISSA MSB (IMPLIED "1")
040000             0019  ;   MANTISSA=0 & EXPONENT=0 IMPLIES VALUE IS ZERO.
040000             0020  ;
040000             0021  ;BINARY INTEGER REPRESENTATION:
040000             0022  ;   32 BIT 2'S-COMPLEMENT SIGNED INTEGER
040000             0023  ;    "EXPONENT" BYTE = 0 (WHEN PRESENT)
040000             0024  ;
040000             0025  ;NORMAL REGISTER ALLOCATION: MANTISSA - HLH'L'
040000             0026  ;                            EXPONENT - C
040000             0027  ;ALTERNATE REGISTER ALLOCATION: MANTISSA - DED'E'
040000             0028  ;                               EXPONENT - B
040000             0029  
040000             0030  
040000             0031  
040000             0032  ;
040000             0033  ;MULA, MULB - MULTIPLICATION PRIMITIVE.
040000             0034  ;    Function: H'L'HLD'E'DE = B'C'BC * D'E'DE
040000             0035  ;    Inputs: A = loop counter (usually -32)
040000             0036  ;            H'L'HL = 0
040000             0037  ;    Destroys: D,E,H,L,D',E',H',L',A,F
040000             0038  ;
040000 B7          0039  MULA:			OR      A               ;CLEAR CARRY
040001 D9          0040  MUL0:			EXX
040002 CB 1A       0041          		RR      D               ;MULTIPLIER/2
040004 CB 1B       0042          		RR      E
040006 D9          0043          		EXX
040007 CB 1A       0044          		RR      D
040009 CB 1B       0045          		RR      E
04000B 30 07       0046          		JR      NC,MUL1
04000D 52 09       0047          		ADD.S   HL,BC           ;ADD IN MULTIPLICAND
04000F D9          0048          		EXX
040010 52 ED 4A    0049          		ADC.S   HL,BC
040013 D9          0050          		EXX
040014 3C          0051  MUL1:			INC     A
040015 F0          0052          		RET     P
040016 D9          0053  MULB:			EXX
040017 CB 1C       0054          		RR      H               ;PRODUCT/2
040019 CB 1D       0055          		RR      L
04001B D9          0056          		EXX
04001C CB 1C       0057          		RR      H
04001E CB 1D       0058          		RR      L
040020 C3 01 00 04 0059          		JP      MUL0
040024             0060  
